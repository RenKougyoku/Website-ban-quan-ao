@using webmaylanh.Models
@model ItemGioHang

@{
    ViewBag.Title = "Cập Nhật Giỏ Hàng";
    Layout = "~/Views/Shared/_LayoutUser.cshtml";
}
<h2 style="font-family:'Times New Roman';text-align:center"><strong>CẬP NHẬT GIỎ HÀNG CỦA BẠN</strong></h2><br />
@{
    List<ItemGioHang> lstGioHang = ViewBag.GioHang as List<ItemGioHang>;

}
<div class="cart-items">
    <div class="in-check">
        <div class="container">
            <div class="table-responsive">
                <table class=" table table-striped table-bordered table table-condensed">
                    <tr style="text-align:center">
                        <td>Mã Sản Phẩm</td>
                        <td>Tên Sản Phẩm</td>
                        <td>Hình Ảnh</td>
                        <td>Số Lượng</td>
                        <td>Đơn Giá</td>
                        <td>Giảm Giá</td>
                        <td>Thành Tiền</td>
                        <td>Cập Nhật Giỏ Hàng</td>
                        <td>Xóa Giỏ Hàng</td>

                    </tr>
                    @foreach (var item in lstGioHang)
                    {
                        // sản phẩm có mả sản phẩm được chỉnh sửa gửi từ tham số bên xem giỏ hàng
                        if (Model.SanPhamID == item.SanPhamID)
                        {
                            using (Html.BeginForm("CapNhatGioHang", "GioHang"))
                            {
                                <tr style="text-align:center">
                                    <td>@item.SanPhamID @Html.Hidden("SanPhamID", item.SanPhamID)</td>
                                    <td>@item.TenSanPham</td>
                                    <td><img src="@Url.Content("~/" +item.HinhAnh)" style="height:200px;width:150px" /></td>
                                    <td>
                                        @Html.TextBox("SoLuong", item.SoLuong, new { @class = "SoLuongThayDoi" })
                                        <p style="color:red;" id="TB_SoLuongThayDoi"></p>
                                    </td>
                                    <td>@string.Format("{0:0,0 VNĐ}", item.DonGia).Replace(",", ".")</td>
                                    <td>@Html.FormatValue(item.GiamGia, "{0:p}")</td>
                                    <td>@string.Format("{0:0,0 VNĐ}", item.TongTien).Replace(",", ".")</td>
                                    <td> <input type="submit" value="Cập Nhật" class="btn btn-success " id="btnCapNhatGH"></td>
                                    <td>@Html.ActionLink("Xóa Giỏ Hàng", "XoaGioHang", new { @SanPhamID = item.SanPhamID }, new { @class = "btn btn-danger" })</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr style="text-align:center">
                                <td>@item.SanPhamID</td>
                                <td>@item.TenSanPham</td>
                                <td><img src="@Url.Content("~/Content/CssHome/HinhSanPham/" +item.HinhAnh)" style="height:200px;width:150px" /></td>
                                <td>@item.SoLuong</td>
                                <td>@string.Format("{0:0,0 VNĐ}", item.DonGia).Replace(",", ".")</td>
                                <td>@Html.FormatValue(item.GiamGia, "{0:p}")</td>
                                <td>@string.Format("{0:0,0 VNĐ}", item.TongTien).Replace(",", ".")</td>
                                <td>@Html.ActionLink("Chỉnh Sửa", "SuaGioHang", new { @SanPhamID = item.SanPhamID }, new { @class = "btn btn-success" })</td>
                                <td>@Html.ActionLink("Xóa Giỏ Hàng", "XoaGioHang", new { @SanPhamID = item.SanPhamID }, new { @class = "btn btn-danger" })</td>
                            </tr>
                        }
                    }
                </table>
            </div>
        </div>
    </div>
</div>
<script>
    $("#btnCapNhatGH").click(function () {
        //Kiểm tra số lượng không phải là số hoặc nhỏ hơn 0
        var SoLuong = $(".SoLuongThayDoi").val();
        if (isNaN(SoLuong) == true || SoLuong < 0) {
            $("#TB_SoLuongThayDoi").text("Số lượng không hợp lệ!");
            return false;
        }
    });
</script>

 